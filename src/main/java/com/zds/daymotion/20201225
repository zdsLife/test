



系统字段出问题的邮件报警 自动发送的实现方案设计


触发条件：系统里面的有些字段出问题 但是 需要解决 需要打电话 自动发邮件等机制 来通知对应负责人来修改













背景来源：
数据系统页面所展示的指标数值， (由于人的原因导致的数据异常值  系统需要二次排查)
是由源端生产系统源库的多张表数据集合，
一旦业务操作人员在填写\上传时输入有误，或操作不规范超出业务逻辑的范围，
加之系统并未对该数据进行审核约束，导致数据系统得出的指标数据不可信，影响业务决策，甚至会产生错误的决策。

目的：
对字段规则验证，一旦异常报错，
即可快速定位该字段影响目标系统哪个功能下的哪个指标，
谁关注，并自动通知关注该指标的业务、产品和技术，快速预警和警告

需求：
对数据系统源端double字段阈值的规则监测配置，
一旦规则告警，通过字段血缘关系，层级检索到dm指标表（支撑数据系统业务或同步数据系统数据库的数据表），
在经过指标表从应系统\功能\指标路径检索中，获取业务\产品\技术联系人邮箱地址，
并调用邮件发送服务模块，按照邮件模板对以上联系人发送通知邮件。

完成以上目标需求，分为以下子任务
子任务1：数据系统源表数值型取值范围统计：基于已提供的数据系统溯源表double字段清单，反查字段取值范围，平均值、最小值和最大值
子任务2：基于ods（元数据表）字段到dm指标表，整个字段血缘影响关系的组合
子任务3：创建中间表，指标表与系统功能\指标与联系人的关系
子任务4：邮件模块开发需求，开发邮件模板、包含收件人、发件人、抄送人、邮件主题、邮件内容和邮件签名，并记录出发记录


邮件报警触发记录表 trigger_record
        发送时间
        收件人
        发送主题
        发送状态


触发邮件发送的方法
1.如何验证业务系统的那些数据的 那些字段 是否有问题
2.开发需要的参数
3.如何获取开发的这个接口的 执行触发条件???
4.接口入参的 参数梳理
  1）收件人：业务联系人 2）发件人：当前发送地址 3）抄送人：技术、产品运营联系人
  4）邮件主题：5）xx字段预警，将会影响6）xx系统7）xx指标




邮件模块开发需求，
1、邮件模板的开发如下：
        收件人：业务联系人
        发件人：当前发送地址
        抄送人：技术、产品运营联系人
        邮件主题：xx字段预警，将会影响xx系统xx指标

邮件内容
您好
阿里云源表xx字段规则监测，发现xx字段（中/英）数值＜0（正常≥0），
会影响到xx系统>xx>xx>xx的指标结果展示，供决策参考。
如有疑问请联系产品运营（刘XX 17801611798 liuxx@qq.com）或技术（侯亚乾 18802110876 houxx@qq.com）
邮件签名：该邮件为系统自动触发，请勿回复

2:、邮件触发记录
包含发送时间、收件人、邮件主题、发送状态，便于发送记录的查询


围绕数据的操作
      系统错误的数据 细到那个系统的那张表的那个字段 举例：登录系统的用户的年龄不可能大于200岁 或者年龄不可能为负数










标签筛选 获取的标签枚举值 要进行排序 如系统返回值 是12 , 8,7,23 需要排序

return esUtil.getAllEnumValue(index, tagField);
return esUtil.getSampleTextValueByPhrase(index, tagField, 0, pageSize, keyword).stream().distinct().collect(Collectors.toList());


--------------->>>>电脑配置次了 导致 有些从es 获取的数据 还没拿完 就报超时异常了


集市指标层直接面向于需求，直接对外提供服务，进行个性化指标开发，报表拼接等工作
公共指标尽量沉淀到dws层，本层只做个性化指标的开发以及报表拼接等直接对接需求的工作
DM层数据可以直接面向报表前端展示需求和应用场景


任务运行完 同步完 执行字段 同步规则  任务的开始结束时间 查询任务状态的接口

这个时间


锊一下  锊一下 这个思路





阿里云上跑的任务

  给个定时任务 确定

  监听到 血缘 对应的那个系统的那张表的那个字段 与之前配置的字段数据规则 是否一致 （举例： 人的年龄 不可能为负数）




把自己理解的东西 写下来 反复琢磨
把自己理解的东西 写下来 反复琢磨
把自己理解的东西 写下来 反复琢磨
把自己理解的东西 写下来 反复琢磨
把自己理解的东西 写下来 反复琢磨
把自己理解的东西 写下来 反复琢磨


















是这样的 数据中心的建设 数仓的理解 涉及几个 概念 名称
    different business system
    sap(企业记账)
    crm（企业维护客户关系）
    金融系统



1，告警状态 可以拿到  但是假如 系统有39张表  目前实现思路
dataWork 系统查看对应不同的系统 各个表里面的各个字段





先从各个 业务系统的对应mysql库 拿数据
通过放到ops operator data service ods 可以操作的数据服务 理解 先有各个系统的数据备份和增量更新
从ops 拿数据 到 数仓中 注意啦 注意啦 这一步开始 对数据进行初步整理






阿里云 三种情况的通知： 钉钉webhook 阿里给配置的大数据中心企业版里面设置的邮箱发送邮件

经验积累：
      经典问题： 让研发开发一个根据 手机壳颜色 变更系统单颜色 进行适配 （难度比较高）
      乾哥 与厚磊 关于邮件报警的触发机制 这个地方的问题商量沟通 讨论
      厚磊以为 这个状态有错误 可以捕捉到 邮件的发送接口或者想通过 登录阿里云里面的dataWork 系统
      爬取监控的数据 然后拿正常值 进行校验 但是这样有账号被封的风险
      乾哥的思路：最开始 产品 这一块思路不清晰 不接这个需求




      乾哥提供的思路：通过调用阿里云的sdk 里面查询监控列表数据 获取
























      开一个公共邮箱 没有密码的限制 这样就不担心密码暴露在代码中了



ETL （数据仓库技术）
ETL，是英文Extract-Transform-Load的缩写，
用来描述将数据从来源端经过抽取（extract）、转换（transform）、加载（load）至目的端的过程。
ETL一词较常用在数据仓库，但其对象并不限于数据仓库。









