
uat 环境测试开发平台

现在的问题:
1.jenkins 打包数据平台出了问题
2.项目合完代码 可以运行 但是访问不跳转了（今天这个bug 居然没有做任何修改就消失了）
3.数据权限 这一块 如何处理  新建部门表  部门与标签进行关联
4.权限和组关联  角色和组关联
5.对于版本比较低的mysql 是不支持utf8mb4 考虑线上环境
6.uat 环境 配置好data-web jenkins 任务 build
7.存到session 里面的jessionid 是否有过期时间 这里先定半个小时 60*60*1000=3600000
8.我从cas-server 哪里 可以拿到登录用户的那些信息


==============重要重要重要重要重要重要[今天UAT 一定要成功 访问 ]==============


规划一下 初始化 时候可能要准备的数据 两大类
一：标签分类表和标签表 的数据录入
二：用户权限 角色 角色权限的配置




数据权限的分析：

由于标签管理员 会根据数仓里面的宽表来创建系统标签
（这里的标签 可能会出现的情况 有
1.多个系统标签的组合
2.其他部门的人创建的组合标签之间的组合
3.系统和组合标签构成的标签）（疑问标签表里面要不要加一个字段来区分这个标签是系统管理员创建的还是 其他业务部门创建的）

对于单个标签 这里面 有这样一个流程 假如销售创建的标签A 风控部门想使用 这个时候风控部门需要提交申请 产生申请的记录
由于单个标签对应一行记录 不像功能权限 比如说一个权限码写在一个接口查询的接口上requirePermission(value="user:query") 这样可能会出现 这样的情况
查全表   根据条件查询

是否可以这样设计 标签表 里面有个部门集合字段
问题产生的原因   标签管理员产生的标签是否是所有业务人员都可以使用 不是（业务人员都可以看，但不是都可以用
（也就是当业务人员想使用这个系统标签来创建组合标签的时候
下拉菜单查询是基于这个用户是否有这个标签的权限来决定下拉菜单要展示那些 可以供这个当前的用户可选的标签标签
（实现的想法  判断的依据 如果这个标签的部门集合里面的元素包含contain 这个用户所在的部门 则显示这个标签 ）），
业务人员只能使用属于本部门的权限的标签）
这样也就意味着   你这个标签管理员创建的标签


















返回 权限数组

给这个用户一个默认角色




数据库脚本


插入权限表的数据

插入角色表的数据

插入角色权限表的数据


data-backend/backend/src/main/resources/*.yml
data-backend/backend/src/main/resources/*.properties



1.数据库 部署项目

删除已有的数据库   drop database id exist data_web
创建新的数据库     create database data_web use charset=utf8mb4
使用新创建的数据库
建表 create table tabename;
drop database  if exists data_web;
create database data_web charset utf8mb4;
use data_web;
对于shiro的理解：
实际是整合拦截器和过滤器
同过在客服端与服务端 建立连接的过程中
通过session 拿到这个用户的属性信息
比如 这个用户subject的用户名 实际是在cas server 登录认证成功之后 拿到cas 连接的数据库里面登录的用户信息 一般会有这个用户的企业邮箱 用户别名

但是认证成功之后 会经过你的系统进行一个授权的过程 你可以赋值一个默认权限（注意 注意 这里 需要考虑 你系统整体的权限规划 ）

比如我这里 现在 目前分三大类角色

超级管理员（公司老板 各个部门的主管 或者来说 组长）（树的根节点）

标签管理员（产品经理）

业务人员（销售部 增长部 销售部）

----超级管理员
------------标签管理员
------------业务人员（分属各个部门 所属组）

这里一开始给默认权限 实际是把用户和给的默认角色建立关联
getOrInsert 如果不是首次登录 则插入用户表 并且给一个默认的角色 在realm 里面的授权把这个拥有权限和角色的用户session添加到redis
            如果是则直接去之前第一次存的用户信息 存到session里面





权限功能的分析：
1.


反思：自己的时间意识 及对于小问题的处理 时间消耗耽误了工程进度


对于这里分页的使用

分页pagehelp 对于单个一次返回所有数据的可以进行分页
这里有查询某一个角色下的所有用户getAllUser
传入的是根据这个用户的各个属性可能会作为查询条件



总结
接口：
增加 insert  add      save     传入对象 post @RequestBody 请求体
删除 delete  remove            传入
修改 update  modify
查询 select  query


自己的想法 关于cas 跳转 纬仲的建议

20201113daylog
一 今天的工作进度：
1.把权限功能相关的（权限 角色 用户）经亚乾帮助 部署到uat环境
2.由于自己没有加登录成功之后跳转首页 加上 纬仲在忙 前端首页的展示
部署之后的后端接口没有联调计划明天周六修改纬仲提交的bug
3.自己在思考数据权限那一块 晚上聊天有反馈（我的想法 tag标签表添加一个部门deptids
字段集合  萧哥你的 意见 由于多对多的关联关系 建议建一张 部门标签表 维护这种关系）


二 存在的疑问：

1.基于遵循阿里持久层的开发规范 尽量避免弱sql
我想的是尽可能的避免两张表以上的关联 正如萧哥你建议的
对于多表的查询 把关联的逻辑转移到业务代码中（这个我需要写代码去感受）
2.由于我现在是基于慧小贷那一块 亚乾拷过来的代码 修改 所以需要熟悉别人写代码的思路
（修改别人代码比自己重新写要费时间）
如果时间充裕的话 我有想 自己把那一块的代码自己去实现
3.可能周六日修改bug 会有提pr的请求 到时候麻烦萧哥合一下代码






















