



1.细则 为什么要分组


我今天在那些方面 耽误时间了

1.工具使用的不熟
2.业务逻辑的反复确认
3.框架使用不熟
4.修改bug费时 在那种bug 修复花费的时间比较多 对于一些简单问题的快速精确定位 比较慢
5.与前端配合 由于前端 用的是本地调试  给我的是他本地环境的前端报错信息
    我只能看到一个模糊的错误码  我习惯 在uat 环境 直接看日志 复现 这个bug 然后 进行修改
6.没有大块的整段时间 容易被人带的分散精力
7.对于经常用到的网站 建立按文件夹 分类建立收藏
8.对于经常用的软件 建立 桌面快捷方式
9.对于俊雅 每次跟维仲 聊产品细节 我都不想遗漏 大部分信息与我关系不大
10. 纠结 某些问题的实现




标签涉及的数据权限
标签筛选涉及的组合条件的 数据权限



相同角色 只能查看相同角色 之前设置标签组合条件规则
比如风控 可以查看 自己之前 筛选某些标签的组合条件

设计思路 同一个部门下的用户 可以查看之前 同一部门的其他同事创建的标签筛选规则（这个需要跟产品确认吗）

select deptId from sys_user where username= "当前登录的邮箱账号"

select * from 标签筛选表 where deptId = (select deptId from sys_user where username= "当前登录的邮箱账号")
用户在创建标签筛选条件的时候 把 这个用户的  业务角色  根据用户的业务角色
这个角色 id 与标签筛选条件绑定
用户如何查看和修改标签筛选项条件
（根据用户登录的邮箱账号 获取 这个用户的部门id  每一个用户登录 都会获取 这个用户的部门id 把部门id 耦合到标签筛选表
和 每次查询的时候 把 这个部门id 下的所有标签筛选 和筛选细则 带出来）

另一种 是通过使用角色id  给六大部门 设立各自的角色  把角色id 耦合到 标签筛选表和标签细则表


功能权限：标签筛选 业务人员 标签管理员

有事多跟乾哥商量




标签筛选 当前登录的用户保存的标签筛选条件 放在create_user

如果是超级管理员 则可以 全表查询 标签
如果是当前业务人员所在部门的标签筛选项条件管理员
如果是当前普通业务人员 则可以

今天 纠结 俊雅姐那边的数据权限

你说能看到的编辑查询按钮 多是功能权限

部门名称
实体名称
标签名称 数据库字段加唯一索引



        /**
         * 数据权限的产生背景： 标签筛选里面 针对不同的用户 来自的部门不同  有些系统标签根据wiki
         * @https://zlfzb.kungeek.com/confluence/pages/viewpage.action?pageId=92766225
         * 上的画像标签体系里面的 具体系统标签 归属的部门 来设置这个标签权限的所属 也就是说 标签管理员通过 数据平台录入系统标签的时候
         * 这里都需要维护 这个标签id 和 这个部门id 的关联关系 存到部门标签表里面
         * 实现判定用户是否具有查看某个标签的逻辑：
         * 根据用户通过cas 认证 在本系统内获取这个用户的邮箱账号 根据用户端邮箱账号获取这个账号在用户表里面的这个用户所在的部门
         * 根据这个部门 获取标签部门表里面的这个部门拥有的标签集合 所展示的标签 就是这个用户可以使用 和看到的标签（用于标签组合条件筛选二期）
         */
        TagDeptDO tagDeptDO = new TagDeptDO();
        tagDeptDO.setTagId(tagDO.getId());
        tagDeptDO.setDeptId(userMapper.getDeptIdByUserName(userName));
        tagDeptDO.setSysId(sysId);
        tagDeptDO.setCreateTime(currentTime);
        tagDeptDO.setCreateUser(userName);
        tagDeptDO.setUpdateTime(currentTime);
        tagDeptDO.setUpdateUser(userName);
        tagDeptMapper.insertUseGeneratedKeys(tagDeptDO);


            @Autowired
            private TagDeptMapper tagDeptMapper;

            @Autowired
            private UserMapper userMapper;

控制是否查询es
isQueryES 是否查询ES

纠结 部门名称 权限码 角色名称  是否要加唯一索引





=======================首页的标签都是启用的统计============================































































小技巧： 关于用一个字段 存储多个值 如果查询条件字段 里面 存储多个条件

有的人习惯 会让 前端 传 各个条件数组集合 用逗号隔开 例如 {年龄,性别,民族}
有的人习惯 把这些条件存到 LIst 集合里面 然后 通过json 化 存到 条件字段这一列里面




疑问：
   1.如何定义前端 给我 传的新增按钮 里面的一个筛选细则 标签筛选细则表
         sysId 用户筛选某一个标签体系 构成 这个体系下 多个组的 和
         一个标签筛选项 有多个组 一个组 有多个细则 一个细则对应的标签值有多个
         标签筛选项
                 标签组合1
                        细则1
                            条件值1
                            条件值2
                            条件值3
                        细则2
                        细则3
                 标签组合2
                        细则1
                            条件值1
                            条件值2
                            条件值3
                        细则2
                        细则3
                 标签组合3
                        细则1
                            条件值1
                            条件值2
                            条件值3
                        细则2
                        细则3

   2.标签筛选细则组成的组 这个组里面的多个细则之间的逻辑 且或非 必须一致吗
   3.细则a所包含的东西 这个标签组合组A在这个体系下的某个标签AA 这个标签AA对应的多个标签值和
   标签组合A 里的细则b 之间的逻辑关系 且或非



   数据权限：
   关于标签管理员 可以操作的 标签筛选项 应该是所有标签都可以看到
   是否在标签筛选 单独 给标签管理员写一个筛选接口（直接获取指定标签体系下所有可用的标签）

   对于业务人员 只可查看 公开和这个业务人员所在部门的所属的标签

   由于标签值 的数据类型 不一样 如所在城市 可以是枚举的 可以一次 选多个
   但是时间 可以用范围
   对于有些名称的搜索 可以用 单个条件值

   创建管理员 标签管理员 业务人员
   对于 标签筛选条件和 筛选条件覆盖的人群数的 的读写操作增删改
   这里的数据权限 实现业务的逻辑思路是
   根据用户创建的账号 获取用户所在的部门 如果是这个部门 这把这个部门的id 插入到筛选条件 和筛选条件细则表



1.




  20201204daylog
        一 工作进度：
        1.梳理标签筛选项 和 标签的数据权限
        2.删除角色表 权限码表里面无用的字段关联组 用户里面的登录类型
        3.开发标签筛选项里面的标签选择
        4.准备一期sql

        二 存在的疑问：
        1.二期 那三张表（用户 企业 员工） 根据乾哥的意思 是根据用户id去关联
        2.耗时的地方 有些需求 需要反复确认 纠结一些实现上的细节（如标签筛选 如何控制当前用户可以查看自己
        创建 的标签组合条件 我想的是与部门关联 但是乾哥 想的是用户账号关联 ）
