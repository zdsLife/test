


1.看乾哥代码（标签筛选那块es）

  实体编辑：状态码
  断言里面的提示语 用英文 便于
  编辑实体响应的是新增实体的

  重要重要重要！！！！！！！！！！！！！ 项目上线

   检查字段约束：db_metadata tag_field 50 自己的实体 和标签表里面是 30 有问题

   对于俊雅姐在wiki上提的bug问题 我需要预判 这个bug是前端产生 还是后端产生
   补充实体编辑时写入重复的标签名称    返回实体插入重复的响应信息























   数据权限：  基于不同的角色   对于全量数据 的查看范围不同 而产生
   关注两类人的数据获取
   记住 记住 角色 和部门没有绑定关系
   但是需求 里面
   因为添加标签的时候 会关联部门权限 所以用部门标签表来关联

   简化 细化 明确化

   访客角色账号 只具有对系统的功能权限 首页可查看home 标签应用里面的标签分类和系统标签都可查看 标签下的各个标签值详情不可查看
   各个部门的标签管理员角色：

   问题的产生： 不是每一个用户进来 都有部门 也就是这类用户看起来是可以不受 部门绑定的标签约束的
   这个时候 会有这种情况 超级管理员（注意提醒 当超级管理员 给新登进来的用户 赋予标签管理员的时候
   一定要顺带把这个人的用户表对应的部门id 附上 相应的当超级管理员 修改这个用户的部门 那么 这个人之前
   创建的标签筛选条件 这个时候 之前的部门管理员 也就看不到了）
   这样 每一个涉及标签 标签筛选的查询操作  都相应的需要 根据这四大类角色 分别进行处理
   超级管理员： 对标签表 标签筛选表 全表查询（是否是要启用状态的标签）
       响应的功能权限码：xxx:save xxx:edit xxx:query
       getUserNameByUserUtil(cas 传过来的用户唯一邮箱企业账号) UserUtil    username
       getUserIdByUserName   sys_user                                useId
       getRoleIdByUserId     sys_user_role                           roleId
       getRoleNameByRoleId   sys_role                                roleName
       getDeptIdByUserId     sys_user                                deptId

       根据用户工具类获取当前用户的邮箱账号 根据邮箱账号 获取这个用户的 用户id  和部门id
       根据用户id 获取用户角色 对应的角色id  根据用户的角色id获取这个角色的角色名
       按照不同的角色名 和不同的部门 展示对应的行数据
       这里就要把功能权限和数据权限划分清
       如对于不限制到某一个人 可读写的操作 涉及的增删改查 为功能权限 但是如果需要展示某一个人可查看的范围


       对于获取某个业务用户 不是这个部门的标签管理员的用户 创建的标签筛选条件 当用户访问有标签筛选的查询的功能权限的时候
       这个时候 需要拿到这用户角色
       如果是普通访客 返回null 如果是这个部门的业务人员 这个根据这个用户的账号username 获取
       标签筛选表里面create_name = 这个业务人员的邮箱账号的 所有标签筛选条件
       如果是标签管理员 这个时候 需要获取 这个部门所有用户的邮箱账号 因为 按照某个部门管理员可以读写 这个部门所有人曾经创建和编辑的标签筛选项
       根据 这个部门员工的邮箱账号集合 可以获取这个 每一个员工曾经创建的标签筛选项

       getDeptIdBy


       标签查询的时候 需要按照角色查询 这个部门的这角色 可以查看的标签



   标签管理员的思路：
   有个空闲期 也就是当这个用户 不是访客 或者是超级管理员角色 进来的时候 这个时候 这个用户再次登录系统




   用户
   部门
   角色
   标签
   标签筛选条件
   用户分群（基于标签组合条件 标签筛选项 获取的用户分群数据 产生的概念）



   别把自己绕进去了
   比如编辑一个对象
   这个对象名称 建立了唯一索引
   也就是在写操作的过程中 需要在用户输完name 需要前端 单独把这个值 传到后端 看看这个名称有没有可能重复
   但是在用户编辑这个对象 并没有修改 这个用户名字的时候 也就是说 当用户修改这个值 如果在根据name 从数据库查到不止一条数据 说明数据库 是有重复的
   需要
   对于添加操作 原有nameA 现在又添加 nameA 会重复
   对于修改操作 原有nameB 现在现在不修改 还是nameB 此时查询数据库 就是 这个没有修改的这一条数据
   注意顺序 是你要把这个名称 改为什么名字 但是你不知道这个名字 数据库是否已经有了这条数据 这个时候 你这个要更新成的值 如果数据库有一条同名的数据
   你要更新成的这行数据就会重复报错的













   权限码


//        this.checkTagCategoryDuplicate(tagCategoryVO.getSysId(),tagCategoryVO.getName());

//        if(null!=tagName){
//            List<TagDO> tagDOS = tagMapper.getTagsByTagName(tagName);
//            AssertUtil.assertEmpty(tagDOS,"tagName: "+tagName+" repeat");
//        }

     String entityName = entityVO.getName();
        if(null != entityName){
            List<EntityDO> entityDOList = entityMapper.getEntityByName(entityName);
            AssertUtil.assertEmpty(entityDOList,"entityName: "+entityName+" repeat");
        }


    @Autowired
    private EntityMapper entityMapper;

    部门的id 耦合 便于标签管理员获取所在部门其他员工创建的标签筛选项

    切换新的分支 由于之前的分支 新改的代码 没有同步合并 导致的异常
    之前 发现关联组 associateGroup 导致的异常


  20201208daylog
        一 工作进度：
        1.梳理给的系统功能和数据权限脑图 并和你讲述自己的实现逻辑
        2.给维仲提的标签查询接口 添加标签分类id 的条件
        3.去掉防御代码 实体 标签 标签分类 里面的去重逻辑

        二 存在的疑问：
        1.切换新的分支 由于之前的分支 新改的代码 没有同步合并 导致的异常
        之前 发现关联组 associateGroup 导致的异常
        2.超级管理员 也有创建标签筛选的权限 但是没法给标签筛选设置部门id 因为超级管理员没有部门










